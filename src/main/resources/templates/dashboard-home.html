<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
<meta charset='utf-8' />
<script src='../dist/index.global.js'></script>
<script src="main.js" defer></script>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="sidebar.css">
<link rel="stylesheet" href="table.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!--
  Seite für den Stundenplan erstellen mit iframe

-->

<script>

document.addEventListener('DOMContentLoaded', function() {
  var eventid;
  var calendarEl = document.getElementById('calendar');

  var calendar = new FullCalendar.Calendar(calendarEl, {
    timeZone: 'local',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,dayGridWeek,timeGridDay'
    },
    events: [
        {
          id: "1",
          title: 'Mein Event',
          start: '2023-03-16T10:00:00',
          end: '2023-03-17T12:00:00',
          color: '#378006',
          description: 'Eine Beschreibung meines Events'
        },
      ],
    initialDate: new Date(),
    navLinks: true, // can click day/week names to navigate views
    editable: true,
    businessHours: true, // display business hours
    dayMaxEvents: true, // allow "more" link when too many events
    selectable: true,
    weekNumbers: true,    
    eventClick: function(info) {
  eventid = info.event.id;
  console.log(eventid);
  document.getElementById('event-title2').value = info.event.title;
  
  // Setze das Anfangsdatum im ISO-Format
// Datum in das gewünschte Format umwandeln
var startDate = info.event.start;
var endDate = info.event.end;
if (startDate) {
  startDate = startDate.toISOString().substr(0, 10); // "yyyy-mm-dd" format
}
if (endDate) {
  endDate = endDate.toISOString().substr(0, 10); // "yyyy-mm-dd" format
}

// Datum in das input Feld einsetzen
  document.getElementById('event-start-date2').value = startDate;
  document.getElementById('event-end-date2').value = endDate;

  document.getElementById('event-color2').value = info.event.backgroundColor;
  document.getElementById('event-description2').value = info.event.extendedProps.description;

  document.getElementById('event-form-clickevent').style.display = 'block';  
},
    eventDrop: function(info){
      var eventidcurrent = eventid
      $.ajax({
    url: '/api/module/',
    type: 'PUT',
    contentType: 'application/json' + eventidcurrent,
    data: JSON.stringify(info.event),
    success: function(data) {
      // Ereignis erfolgreich aktualisiert
      console.log(data);
    },
    error: function(xhr, status, error) {
      // Fehler beim Aktualisieren des Ereignisses
      console.log(error);
    }
  });
      
    }, 
    eventResize:function(info){
      var eventidcurrent = eventid
      $.ajax({
    url: '/api/module/' + eventidcurrent,
    type: 'PUT',
    contentType: 'application/json',
    data: JSON.stringify(info.event),
    success: function(data) {
      // Ereignis erfolgreich aktualisiert
      console.log(data);
    },
    error: function(xhr, status, error) {
      // Fehler beim Aktualisieren des Ereignisses
      console.log(error);
    }
  });
    }


  




  });
      // fetch events from Spring Boot API
      $(document).ready(function() {
  $.ajax({
    url: '/api/module', // URL zur Abfrage der Ereignisse
    type: 'GET',
    dataType: 'json',
    success: function(response) {
      // Ereignisse im Kalender anzeigen
      var events = [];
      $.each(response, function(index, event) {
        events.push({
          id: event.id,
          title: event.title,
          start: event.start,
          end: event.end,
          color: event.color
        });
      });
      $('#calendar').fullCalendar('addEventSource', events);
    },
    error: function(jqXHR, textStatus, errorThrown) {
      console.log(textStatus, errorThrown);
    }
  });
});


  calendar.render();



  document.querySelector('.modal-btn2').addEventListener('click', function() {
  var title = document.getElementById('event-title2').value;
  var start = new Date(document.getElementById('event-start-date2').value).toISOString();
  var end = new Date(document.getElementById('event-end-date2').value).toISOString();
  var color = document.getElementById('event-color2').value;
  var description = document.getElementById('event-description2').value;
  var eventidcurrent = eventid
  var dropdown = document.getElementById('dropdown').value;
  // Hier kannst du die Werte in einem Objekt speichern
  var eventData = {
    title: title,
    start: start,
    end: end,
    backgroundColor: color,
    description: description,
    dropdown: dropdown
  };

  // Hier kannst du die Werte ausgeben, um sicherzustellen, dass sie korrekt erfasst wurden
  console.log(eventData);
  console.log(eventid)
  

  // Hier kannst du den Event im Kalender aktualisieren
  var eventObj = {
    title: title,
    start: start,
    end: end,
    backgroundColor: color,
    description: description,
    dropdown: dropdown
  };

  $.ajax({
    url: '/api/module/' + eventidcurrent,
    type: 'PUT',
    contentType: 'application/json',
    data: JSON.stringify(eventData),
    success: function(data) {
      // Ereignis erfolgreich aktualisiert
      console.log(data);
    },
    error: function(xhr, status, error) {
      // Fehler beim Aktualisieren des Ereignisses
      console.log(error);
    }
  });

  var event = calendar.getEventById(eventidcurrent);
  event.setProp('title', title);
  event.setStart(start);
  event.setEnd(end);
  event.setProp('backgroundColor', color);
  event.setExtendedProp('description', description);

  // Hier kannst du das Modal schließen
  document.getElementById('event-form-clickevent').style.display = 'none';

  calendar.render();
});

document.querySelector('.modal-btn-delete').addEventListener('click', function() {
  var eventIdcurrent = eventid; // ID des ausgewählten Events
  var event = calendar.getEventById(eventIdcurrent); // Event-Objekt abrufen
  if (event) {
    event.remove(); // Event löschen
    $.ajax({
    url: "/api/module/" + eventidcurrent,
    type: "DELETE",
    success: function(data) {
      // Event erfolgreich gelöscht
      console.log(data);
    },
    error: function(xhr, status, error) {
      // Fehler beim Löschen des Events
      console.log(error);
    }
  });


  }
  // Modal schließen
  document.getElementById('event-form-clickevent').style.display = 'none';
});





  // Add event listener to "Create Event" button
  var addEventBtn = document.getElementById('add-event-btn');
  addEventBtn.addEventListener('click', function() {
    document.getElementById('event-form').style.display = 'block';
  });

    // Add event listener to "Close" button in the form
    var closeBtn = document.getElementsByClassName('close')[0];
  closeBtn.addEventListener('click', function() {
    document.getElementById('event-form').style.display = 'none';
  });
     // Add event listener to "Close" button in the form
     var closeBtn = document.getElementsByClassName('close2')[0];
  closeBtn.addEventListener('click', function() {
    document.getElementById('event-form-clickevent').style.display = 'none';
  });
  


  // Add event listener to form submission
  var form = document.querySelector('form');
  
  form.addEventListener('submit', function(event) {
    event.preventDefault();
    
    // Get form values
    var title = document.getElementById('event-title').value;
    var start = new Date(document.getElementById('event-start-date').value).toISOString();
    var end = new Date(document.getElementById('event-end-date').value).toISOString();
    var color = document.getElementById('event-color').value;
    var description = document.getElementById('event-description').value;
    var id = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
    var dropdown = document.getElementById('dropdown').value;


    // Create event object
    var eventObj = {
      id: id,
      title: title,
      start: start,
      end: end,
      color: color,
      extendedProps: {
        description: description
      },
      dropdown: dropdown
    };

    
  $.ajax({
    url: "/api/module",
    type: "POST",
    contentType: "application/json",
    data: JSON.stringify(eventObj),
    success: function(data) {
      // Ereignis erfolgreich erstellt
      console.log(data);
    },
    error: function(xhr, status, error) {
      // Fehler beim Erstellen des Ereignisses
      console.log(error);
    }
  });



    
    // Add the event to the calendar
    calendar.addEvent(eventObj);

    // Reset the form
    form.reset();

    // Hide the form
    document.getElementById('event-form').style.display = 'none';
  });
});


function table_modal(element){
  console.log(element.textContent);
  document.getElementById('modal-table').style.display = 'block';  
  document.getElementById("table-modal-title").textContent = element.textContent;
  
}
function close_tablemodal(){
  document.getElementById('modal-table').style.display = 'none';  
}

</script>



<style>

body {
  
  padding: 0;
  font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
  font-size: 14px;
}

#calendar {
  width: 900px;
  margin: 0 auto;
}
@media (max-width: 760px){

  }

/* Modal styles */
.modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
  background-color: #fefefe;
  margin: 10% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 50%;
}

.close, .close2 {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus,
.close2:hover,
.close2:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}


</style>
</head>
<body>
  <div class="main-page"> 
    <nav>
      <div class="userinfo-navbar">
          <img class="profilepicture-navbar" src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/70/Solid_white.svg/2048px-Solid_white.svg.png">
          <p>Name of the user</p>
      </div>
      <div class="nav-items activesite">
          <svg class="navbar-icon icon icon-tabler icon-tabler-home "xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M5 12l-2 0l9 -9l9 9l-2 0"></path><path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"></path><path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"></path></svg>
          <a style="text-decoration: none;" class="activesite" href="/dashboard-home">Home</a>
      </div>
      <div class="nav-items">
          <svg class="navbar-icon icon icon-tabler icon-tabler-color-swatch" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M19 3h-4a2 2 0 0 0 -2 2v12a4 4 0 0 0 8 0v-12a2 2 0 0 0 -2 -2"></path><path d="M13 7.35l-2 -2a2 2 0 0 0 -2.828 0l-2.828 2.828a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13h-2.3a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h12"></path><path d="M17 17l0 .01"></path></svg>
          <a style="text-decoration: none;">Themenwahl</a>
      </div>
      <div class="nav-items">
      <svg class="navbar-icon icon icon-tabler icon-tabler-question-mark" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M8 8a3.5 3 0 0 1 3.5 -3h1a3.5 3 0 0 1 3.5 3a3 3 0 0 1 -2 3a3 4 0 0 0 -2 4"></path><path d="M12 19l0 .01"></path></svg>
          <a style="text-decoration: none;"  href="/dashboard-anwesenheitsliste">Anwesenheitsliste</a>
      </div>
      <div class="nav-items">
          <svg class="navbar-icon icon icon-tabler icon-tabler-question-mark" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M8 8a3.5 3 0 0 1 3.5 -3h1a3.5 3 0 0 1 3.5 3a3 3 0 0 1 -2 3a3 4 0 0 0 -2 4"></path><path d="M12 19l0 .01"></path></svg>
          <a style="text-decoration: none;" >Klassentools</a>
      </div>  
      </nav>
        <div class="main">
          <div>
          <div id='calendar'></div>
          <button id="add-event-btn" class="btn-style">+ Theme erstellen</button>
        </div>
          <div id="event-form" class="modal">
            <div class="modal-content">
              <span class="close">&times;</span>
              <h2 class="modal-title">Neues Thema</h2>
              <form class="modal-content-flex">
              <div class="modal-add-event">
                <label for="event-title">Title:</label>
                <input class="modal-input modal-title2" type="text" id="event-title" name="title" required>
              
                <label for="event-start-date">Start Date:</label>
                <input class="modal-input modal-start" type="date" id="event-start-date" name="start_date" required>
          
                <label class="modal-end-date-text" for="event-end-date">End Date:</label>
                <input class="modal-input modal-end" type="date" id="event-end-date" name="end_date" required>
              
             
                <label for="event-color">Color:</label>
                <input class="modal-input modal-color" type="color" id="event-color" name="color">
              
                
                <label for="event-description">Description:</label>
                <textarea class="modal-input modal-textarea" id="event-description" name="description"></textarea>

                <label for="event-description">Modul:</label>
                <select name="idk" id="dropdown">
                  <option value="option1">Option1</option>
                  <option value="option2">Option2</option>
                  <option value="option3">Option3</option>
                </select>
              </div>
                <button class="modal-btn btn-style" type="submit">Create</button>
              </form>
            </div>
          </div>


          <div id="event-form-clickevent" class="modal">
            <div class="modal-content">
              <span class="close2">&times;</span>
              <h2 class="modal-title">Thema ändern</h2>
              <form class="modal-content-flex">
              <div class="modal-add-event">
                <label for="event-title">Title:</label>
                <input class="modal-input modal-title2" type="text" id="event-title2" name="title" required>
              
                <label for="event-start-date">Start Date:</label>
                <input class="modal-input modal-start" type="date" id="event-start-date2" name="start_date" required>
          
                <label class="modal-end-date-text" for="event-end-date">End Date:</label>
                <input class="modal-input modal-end" type="date" id="event-end-date2" name="end_date" required>
              
             
                <label for="event-color">Color:</label>
                <input class="modal-input modal-color" type="color" id="event-color2" name="color">
              
         
                <label for="event-description">Description:</label>
                <textarea class="modal-input modal-textarea" id="event-description2" name="description"></textarea>
                <label for="event-description">Modul:</label>
                <select name="idk" id="dropdown">
                  <option value="option1">Option1</option>
                  <option value="option2">Option2</option>
                  <option value="option3">Option3</option>
                </select>
              </div>
                <button class="modal-btn2 btn-style" type="button">Ändern</button>
                <button class="modal-btn-delete btn-style" type="button" onclick="deleteEvent()">Delete</button>

              </form>
            </div>
          </div>
          <div id="modal-table" class="modal">
            <div class="modal-content">
              <span onclick="close_tablemodal()" class="close2">&times;</span>
              <h2 class="modal-title" id="table-modal-title">Themen zu diesem Modul</h2>
              <table class="table">
                <thead class="thead">
                <tr class="tr">
                  <th class="th">Title</th>
                  <th class="th">Farbe</th>
                  <th class="th">Startdatum</th>
                  <th class="th">Enddatum</th>
                  <th class="th">Beschreibung</th>
                  <th class="th">ID</th>
                </tr>
                </thead>
                <tbody class="tbody">
                <tr>
                  <td class="td">Thema 1</td>
                  <td class="td">Thema 2</td>
                  <td class="td">Thema 3</td>
                  <td class="td">Thema 4</td>
                  <td class="td">Thema 5</td>
                  <td class="td">Thema 6</td>
                </tr>
   
               
                </tbody>
              </table>     
              </form>
            </div>
          </div>
          


          <div class="table-margin">
            <h2>Themen</h2>
            <table class="table">
              <thead class="thead">
                <tr class="tr">
                  <th class="th">Module</th>
                </tr>
              </thead>
              <tbody class="tbody" id="tableBody">
                <tr th:each="module : ${moduleList}">
                  <td class="td" th:text="${module.name}" onclick="table_modal(this)"></td>
                </tr>
              </tbody>
            </table>
               
            
 
          </div>


          


          </div>


          
          </div>


</div>
</body>
</html>